<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Training QR Generator</title>
  <style>
    body {
      font-family: sans-serif;
      max-width: 600px;
      margin: auto;
      padding: 2rem;
    }
    label {
      display: block;
      margin-top: 1rem;
      font-weight: bold;
    }
    select, input {
      width: 100%;
      padding: 0.5rem;
      margin-top: 0.5rem;
    }
    img {
      margin-top: 1.5rem;
      width: 300px;
      height: 300px;
    }
    #output-link {
      word-break: break-all;
      margin-top: 1rem;
    }
  </style>
</head>
<body>
  <h2>Training QR Code Generator</h2>

  <label for="company">Training Company</label>
  <select id="company">
    <option value="">Select a company</option>
    <option value="Bosch Home Comfort">Bosch Home Comfort</option>
    <option value="Gunder Associates">Gunder Associates</option>
  </select>

  <label for="trainer">Trainer Name</label>
  <select id="trainer">
    <option value="">Select a trainer</option>
  </select>

  <label for="date">Training Date</label>
  <input type="date" id="date"/>

  <label for="time">Class Time (AM/PM)</label>
  <select id="time">
    <option value="">Select time</option>
    <option value="AM">AM</option>
    <option value="PM">PM</option>
  </select>

  <label for="city">City</label>
  <input type="text" id="city" placeholder="e.g., Watertown" />

  <label for="state">State</label>
  <input type="text" id="state" placeholder="e.g., Massachusetts" />

  <div id="output-link"></div>
  <img id="qr-code" alt="QR Code" />

  <script>
    const trainers = {
      "Bosch Home Comfort": ["Dave Feyock", "Sean Looby"],
      "Gunder Associates": ["Paul Thieberger", "Ryan Czir"]
    };

    const companyEl = document.getElementById("company");
    const trainerEl = document.getElementById("trainer");
    const dateEl = document.getElementById("date");
    const cityEl = document.getElementById("city");
    const stateEl = document.getElementById("state");
    const timeEl = document.getElementById("time");
    const qrImg = document.getElementById("qr-code");
    const outputLink = document.getElementById("output-link");

    companyEl.addEventListener("change", () => {
      trainerEl.innerHTML = '<option value="">Select a trainer</option>';
      const selectedCompany = companyEl.value;
      if (selectedCompany && trainers[selectedCompany]) {
        trainers[selectedCompany].forEach(name => {
          const option = document.createElement("option");
          option.value = name;
          option.textContent = name;
          trainerEl.appendChild(option);
        });
      }
      updateOutput();
    });

    [trainerEl, dateEl, cityEl, stateEl, timeEl].forEach(el =>
      el.addEventListener("input", updateOutput)
    );

    function updateOutput() {
      const provider = companyEl.value;
      const trainer = trainerEl.value;
      const city = cityEl.value.trim();
      const state = stateEl.value.trim();
      const time = timeEl.value;

      // Don't proceed if required fields are missing
      if (!provider || !trainer || !city || !state || !time) {
        qrImg.src = "";
        outputLink.textContent = "";
        return;
      }

      // Fixed product and level
      const product = "IDS-IDP";
      const lvl = "300";

      const baseUrl = "https://www.boschheatingcooling.com/trf/";
      const params = `?provider=${encodeURIComponent(provider)}%26trainer=${encodeURIComponent(trainer)}%26trainingCity=${encodeURIComponent(city)}%26trainingState=${encodeURIComponent(state)}%26product=${product}%26lvl=${lvl}%26classTime=${time}`;

      const fullURL = baseUrl + params;
      const qrURL = `https://quickchart.io/qr?text=${encodeURIComponent(fullURL)}&size=300`;

      outputLink.innerHTML = `<strong>Prefilled URL:</strong><br><a href="${fullURL}" target="_blank">${fullURL}</a>`;
      qrImg.src = qrURL;
    }
  </script>
</body>
</html>
